<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hodo Admin - Hero Slides</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://unpkg.com/feather-icons"></script>
</head>
<body data-page="hero">

  <div class="dashboard-container">
    <!-- ======================= Sidebar ======================= -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <a href="../index.html" class="logo">HODO<span>ADMIN</span></a>
      </div>
      <nav class="sidebar-nav">
        <a href="index.html" class="nav-link" data-page-link="dashboard"><i data-feather="grid"></i><span>Dashboard</span></a>
        <a href="orders.html" class="nav-link" data-page-link="orders"><i data-feather="package"></i><span>Orders</span></a>
        <a href="products.html" class="nav-link" data-page-link="products"><i data-feather="tag"></i><span>Products</span></a>
        <a href="hero.html" class="nav-link active" data-page-link="hero"><i data-feather="image"></i><span>Hero Slides</span></a>
        <a href="#" class="nav-link"><i data-feather="archive"></i><span>Inventory</span></a>
        <a href="#" class="nav-link"><i data-feather="users"></i><span>Customers</span></a>
        <a href="#" class="nav-link"><i data-feather="settings"></i><span>Settings</span></a>
      </nav>
      <div class="sidebar-footer">
        <a href="#" class="nav-link" data-action="logout"><i data-feather="log-out"></i><span>Logout</span></a>
      </div>
    </aside>

    <!-- ======================= Main Content ======================= -->
    <div class="main-wrapper">
      <!-- Header -->
      <header class="header">
        <h1 class="page-title">Hero Slides Management</h1>
        <div class="header-actions">
          <button class="btn btn-primary" id="addSlideBtn">
            <i data-feather="plus"></i>
            <span>Add Slide</span>
          </button>
          <div class="profile-section">
            <img src="https://i.pravatar.cc/40?u=admin" alt="Admin">
          </div>
        </div>
      </header>

      <!-- Content -->
      <main class="main-content">
        <div class="panel-card full-width">
          <h4 class="panel-title">Hero Slides</h4>
          <p class="panel-description">Manage the slides that appear on the homepage hero carousel. Drag to reorder.</p>
          <div id="slidesList" class="slides-list">
            <!-- Slides will be loaded here -->
            <div class="loading-placeholder">Loading slides...</div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- ======================= Add/Edit Slide Modal ======================= -->
  <div class="modal-overlay" id="slideModal">
    <div class="modal-panel panel-card">
      <div class="modal-header">
        <h4 class="panel-title" id="modalTitle">Add New Slide</h4>
        <button class="icon-btn" id="closeModalBtn"><i data-feather="x"></i></button>
      </div>
      <form id="slideForm" class="modal-form">
        <input type="hidden" id="slideId" name="id">
        
        <div class="form-group">
          <label for="slideEyebrow">Eyebrow Text</label>
          <input type="text" id="slideEyebrow" name="eyebrow" placeholder="e.g., New Collection 2026">
        </div>
        
        <div class="form-group">
          <label for="slideTitle">Title (use <span> for highlighted text)</label>
          <input type="text" id="slideTitle" name="title" placeholder="e.g., Elevate Your <span>Style</span>" required>
        </div>
        
        <div class="form-group">
          <label for="slideDescription">Description</label>
          <textarea id="slideDescription" name="description" rows="2" placeholder="Brief description of the slide"></textarea>
        </div>
        
        <div class="form-group-row">
          <div class="form-group">
            <label for="slideButtonText">Primary Button Text</label>
            <input type="text" id="slideButtonText" name="button_text" placeholder="e.g., Shop Now">
          </div>
          <div class="form-group">
            <label for="slideButtonLink">Primary Button Link</label>
            <input type="text" id="slideButtonLink" name="button_link" placeholder="e.g., #shopGrid or shop.html">
          </div>
        </div>
        
        <div class="form-group-row">
          <div class="form-group">
            <label for="slideSecondaryText">Secondary Button Text</label>
            <input type="text" id="slideSecondaryText" name="secondary_button_text" placeholder="e.g., Contact Us">
          </div>
          <div class="form-group">
            <label for="slideSecondaryLink">Secondary Button Link</label>
            <input type="text" id="slideSecondaryLink" name="secondary_button_link" placeholder="e.g., #contact-panel">
          </div>
        </div>
        
        <div class="form-group">
          <label for="slideImage">Image URL</label>
          <input type="url" id="slideImage" name="image" placeholder="https://..." required>
          <p class="form-hint">Use high-quality images (recommended: 600x800px)</p>
        </div>
        
        <div class="form-group-row">
          <div class="form-group">
            <label for="slideOrder">Display Order</label>
            <input type="number" id="slideOrder" name="order" value="1" min="1">
          </div>
          <div class="form-group">
            <label for="slideActive">Status</label>
            <select id="slideActive" name="is_active">
              <option value="true">Active</option>
              <option value="false">Inactive</option>
            </select>
          </div>
        </div>
        
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" id="cancelBtn">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Slide</button>
        </div>
      </form>
    </div>
  </div>

  <!-- ======================= Delete Confirmation Modal ======================= -->
  <div class="modal-overlay" id="deleteModal">
    <div class="modal-panel panel-card" style="max-width: 400px;">
      <div class="modal-header">
        <h4 class="panel-title">Confirm Deletion</h4>
        <button class="icon-btn" id="closeDeleteBtn"><i data-feather="x"></i></button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete this slide? This action cannot be undone.</p>
      </div>
      <div class="form-actions" style="justify-content: flex-end; display: flex; gap: 1rem;">
        <button type="button" class="btn btn-secondary" id="cancelDeleteBtn">Cancel</button>
        <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
      </div>
    </div>
  </div>

  <script src="../supabase-config.js"></script>
  <script src="../transitions.js"></script>
  <script src="../auth.js"></script>
  <script src="dashboard.js"></script>
  <script>
    // Hero Slides Management
    document.addEventListener('DOMContentLoaded', async () => {
      feather.replace();
      
      // Check auth
      if (!window.HodoAuth) {
        console.error('Auth module not found');
        return;
      }
      
      const isAuthorized = await window.HodoAuth.protectAdminRoute();
      if (!isAuthorized) return;
      
      // Load slides
      await loadSlides();
      
      // Event listeners
      document.getElementById('addSlideBtn').addEventListener('click', () => openModal());
      document.getElementById('closeModalBtn').addEventListener('click', closeModal);
      document.getElementById('cancelBtn').addEventListener('click', closeModal);
      document.getElementById('slideForm').addEventListener('submit', handleSlideSubmit);
      document.getElementById('closeDeleteBtn').addEventListener('click', closeDeleteModal);
      document.getElementById('cancelDeleteBtn').addEventListener('click', closeDeleteModal);
      document.getElementById('confirmDeleteBtn').addEventListener('click', confirmDelete);
    });
    
    let currentDeleteId = null;
    
    // Demo slides for fallback
    const DEMO_SLIDES = [
      { id: 1, eyebrow: 'New Collection 2026', title: 'Elevate Your <span>Style</span>', description: 'Premium menswear crafted for the modern gentleman.', button_text: 'Shop Now', button_link: '#shopGrid', secondary_button_text: 'Contact Us', secondary_button_link: '#contact-panel', image: 'https://images.unsplash.com/photo-1617137968427-85924c800a22?auto=format&fit=crop&w=600&q=80', order: 1, is_active: true },
      { id: 2, eyebrow: 'Summer Essentials', title: 'Sharp Looks for <span>Hot Days</span>', description: 'Lightweight fabrics meet bold designs.', button_text: 'Explore Summer', button_link: 'shop.html?category=Shirts', secondary_button_text: 'View Lookbook', secondary_button_link: '#', image: 'https://images.unsplash.com/photo-1602810318383-e386cc2a3ccf?auto=format&fit=crop&w=600&q=80', order: 2, is_active: true },
      { id: 3, eyebrow: 'Limited Edition', title: 'Exclusive <span>Jackets</span> Are Here', description: 'Handcrafted jackets with premium materials.', button_text: 'Shop Jackets', button_link: 'shop.html?category=Jackets', secondary_button_text: 'Learn More', secondary_button_link: '#', image: 'https://images.unsplash.com/photo-1591047139829-d91aecb6caea?auto=format&fit=crop&w=600&q=80', order: 3, is_active: true }
    ];
    
    async function loadSlides() {
      const container = document.getElementById('slidesList');
      
      // Try to fetch from Supabase, use demo data as fallback
      let slides = DEMO_SLIDES;
      
      if (window.supabaseClient && window.TABLES) {
        try {
          const { data, error } = await supabaseClient
            .from('hero_slides')
            .select('*')
            .order('order', { ascending: true });
          
          if (!error && data && data.length > 0) {
            slides = data;
          }
        } catch (e) {
          console.log('Using demo slides');
        }
      }
      
      if (slides.length === 0) {
        container.innerHTML = '<div class="empty-state">No slides found. Click "Add Slide" to create one.</div>';
        return;
      }
      
      container.innerHTML = slides.map(slide => `
        <div class="slide-item" data-id="${slide.id}">
          <div class="slide-preview">
            <img src="${slide.image}" alt="${slide.eyebrow || 'Slide'}">
          </div>
          <div class="slide-info">
            <h4>${slide.eyebrow || 'No Title'}</h4>
            <p>${stripHtml(slide.title || '')}</p>
            <div class="slide-meta">
              <span class="badge ${slide.is_active ? 'active' : 'inactive'}">${slide.is_active ? 'Active' : 'Inactive'}</span>
              <span>Order: ${slide.order}</span>
            </div>
          </div>
          <div class="slide-actions">
            <button class="btn btn-soft" onclick="editSlide(${slide.id})"><i data-feather="edit-2"></i> Edit</button>
            <button class="btn btn-soft" onclick="deleteSlide(${slide.id})"><i data-feather="trash-2"></i> Delete</button>
          </div>
        </div>
      `).join('');
      
      feather.replace();
    }
    
    function stripHtml(html) {
      const tmp = document.createElement('div');
      tmp.innerHTML = html;
      return tmp.textContent || tmp.innerText || '';
    }
    
    function openModal(slide = null) {
      const modal = document.getElementById('slideModal');
      const form = document.getElementById('slideForm');
      const title = document.getElementById('modalTitle');
      
      if (slide) {
        title.textContent = 'Edit Slide';
        document.getElementById('slideId').value = slide.id;
        document.getElementById('slideEyebrow').value = slide.eyebrow || '';
        document.getElementById('slideTitle').value = slide.title || '';
        document.getElementById('slideDescription').value = slide.description || '';
        document.getElementById('slideButtonText').value = slide.button_text || '';
        document.getElementById('slideButtonLink').value = slide.button_link || '';
        document.getElementById('slideSecondaryText').value = slide.secondary_button_text || '';
        document.getElementById('slideSecondaryLink').value = slide.secondary_button_link || '';
        document.getElementById('slideImage').value = slide.image || '';
        document.getElementById('slideOrder').value = slide.order || 1;
        document.getElementById('slideActive').value = slide.is_active ? 'true' : 'false';
      } else {
        title.textContent = 'Add New Slide';
        form.reset();
        document.getElementById('slideId').value = '';
      }
      
      modal.classList.add('active');
    }
    
    function closeModal() {
      document.getElementById('slideModal').classList.remove('active');
    }
    
    async function handleSlideSubmit(e) {
      e.preventDefault();
      
      const slideData = {
        eyebrow: document.getElementById('slideEyebrow').value,
        title: document.getElementById('slideTitle').value,
        description: document.getElementById('slideDescription').value,
        button_text: document.getElementById('slideButtonText').value,
        button_link: document.getElementById('slideButtonLink').value,
        secondary_button_text: document.getElementById('slideSecondaryText').value,
        secondary_button_link: document.getElementById('slideSecondaryLink').value,
        image: document.getElementById('slideImage').value,
        order: parseInt(document.getElementById('slideOrder').value) || 1,
        is_active: document.getElementById('slideActive').value === 'true'
      };
      
      const slideId = document.getElementById('slideId').value;
      
      // For demo mode, just show success
      alert(slideId ? 'Slide updated successfully!' : 'Slide created successfully!');
      closeModal();
      await loadSlides();
    }
    
    function editSlide(id) {
      const slides = DEMO_SLIDES;
      const slide = slides.find(s => s.id === id);
      if (slide) {
        openModal(slide);
      }
    }
    
    function deleteSlide(id) {
      currentDeleteId = id;
      document.getElementById('deleteModal').classList.add('active');
    }
    
    function closeDeleteModal() {
      document.getElementById('deleteModal').classList.remove('active');
      currentDeleteId = null;
    }
    
    function confirmDelete() {
      alert('Slide deleted successfully!');
      closeDeleteModal();
      loadSlides();
    }
  </script>
  
  <style>
    .slides-list {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    
    .slide-item {
      display: grid;
      grid-template-columns: 120px 1fr auto;
      gap: 1.5rem;
      align-items: center;
      padding: 1rem;
      background: rgba(238, 241, 245, 0.5);
      border-radius: var(--radius-md);
      transition: box-shadow 0.3s ease;
    }
    
    .slide-item:hover {
      box-shadow: var(--shadow-soft-sm);
    }
    
    .slide-preview {
      width: 120px;
      height: 80px;
      border-radius: var(--radius-sm);
      overflow: hidden;
    }
    
    .slide-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .slide-info h4 {
      margin: 0 0 0.25rem;
      font-size: 1rem;
      color: var(--ink);
    }
    
    .slide-info p {
      margin: 0 0 0.5rem;
      font-size: 0.9rem;
      color: var(--muted);
    }
    
    .slide-meta {
      display: flex;
      gap: 1rem;
      font-size: 0.8rem;
    }
    
    .badge {
      padding: 0.2rem 0.6rem;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    
    .badge.active {
      background: #d1fae5;
      color: #065f46;
    }
    
    .badge.inactive {
      background: #fee2e2;
      color: #991b1b;
    }
    
    .slide-actions {
      display: flex;
      gap: 0.5rem;
    }
    
    .form-hint {
      font-size: 0.8rem;
      color: var(--muted);
      margin-top: 0.25rem;
    }
    
    .panel-description {
      color: var(--muted);
      font-size: 0.9rem;
      margin-top: -0.5rem;
      margin-bottom: 1rem;
    }
    
    @media (max-width: 768px) {
      .slide-item {
        grid-template-columns: 1fr;
        text-align: center;
      }
      
      .slide-preview {
        margin: 0 auto;
      }
      
      .slide-actions {
        justify-content: center;
      }
    }
  </style>
</body>
</html>
